!function(t,e){if("function"==typeof define&&define.amd)define("cestino/BasicCartService",["atomicjs/dist/atomic.min"],e);else if("object"==typeof module&&module.exports)module.exports=e(require("atomicjs"));else{t.Cestino=t.Cestino||{};t.Cestino.BasicCartService=e(t.atomic)}}(this,function(t){"use strict";var i={url:""};e.prototype={setProductDataToCart:function(e){var i=this,n={};e.walk(function(t){n[t.getProduct().getId()]=t.getFeatures().map(function(t){return t.getId()})});return t(this[" options"].url,{method:"POST",data:n}).then(function(t){!function(r,o){o.walk(function(t){var i,e,n=[];if(t.getProduct().getId()in r){i=r[t.getProduct().getId()];t.getProduct()[" title"]=i.title;t.getProduct()[" price"]=i.price;t.getFeatures().forEach(function(t,e){if(t.getId()in i.features){t[" label"]=i.features[t.getId()].label;t[" price"]=i.features[t.getId()].price}else n.push(e)});e=n.pop();for(;e;){t[" features"].splice(e,1)[0];e=n.pop()}}else o.deletePosition(t.getId())})}.call(i,t.data,e);return t.data})}};function e(t){this[" options"]=JSON.parse(JSON.stringify(i));for(var e in t)this[" options"][e]=t[e]}return{create:function(t){return new e(t)}}});!function(t,e){if("function"==typeof define&&define.amd)define("cestino/Util",e);else if("object"==typeof module&&module.exports)module.exports=e();else{t.Cestino=t.Cestino||{};t.Cestino.Util=e()}}(this,function(){"use strict";function e(t){return t===+t}function n(t){return e(t)&&t===(0|t)}return{isNumber:e,isInt:n,isFloat:function(t){return e(t)&&t!==(0|t)},isEmpty:function(t){return!t||"0"===t},lpad:function(t,e,i){if(!n(e))throw new TypeError("Parameter width has to be an int!");if((t+="").length>=e)return t;i=i||"0";i+="";return new Array(Math.ceil((e-t.length)/i.length)+1).join(i).slice(0,e-t.length)+t},round:function(t){return parseInt(t.toFixed(0),10)}}});!function(t,e){if("function"==typeof define&&define.amd)define("cestino/PriceFormatter",["cestino/Util"],e);else if("object"==typeof module&&module.exports)module.exports=e(require("./Util"));else{t.Cestino=t.Cestino||{};t.Cestino.PriceFormatter=e(t.Cestino.Util)}}(this,function(o){"use strict";function n(t,e,i){e=e||"";if(-1===[2,3].indexOf(i=i||2))throw new RangeError("The decimal count has to be 2 or 3!");if(-1===[".",",","Ù«"].indexOf(t))throw new RangeError(['"',t,'" is not a typical decimal separator'].join(""));this[" decimalCount"]=i;this[" thousandsSeparator"]=e;this[" decimalSeparator"]=t}n.prototype={format:function(t){if(!o.isInt(t))throw new TypeError("Parameter int has to be an Int!");return[function(t,e){var i,n,r,t=t+"";if(!o.isInt(e))throw new TypeError("Parameter size has to be an Int!");i=Math.ceil(t.length/e);n=t.length%e||e;r=new Array(i);for(;0<--i;)r[i]=t.substr((i-1)*e+n,e);r[0]=t.substr(0,n);return r}(parseInt((t+"").slice(0,-1*this[" decimalCount"]))||0,3).join(this[" thousandsSeparator"]),this[" decimalSeparator"],o.lpad(t%Math.pow(10,this[" decimalCount"]),this[" decimalCount"])].join("")}};return{create:function(t,e,i){return new n(t,e,i)}}});!function(t,e){"function"==typeof define&&define.amd?define("cestino/Cart",["cestino/Util","cestino/BasicCartService","cestino/PriceFormatter"],e):"object"==typeof module&&module.exports?module.exports=e(require("./Util"),require("./BasicCartService"),require("./PriceFormatter")):t.Cestino=e(t.Cestino.Util,t.Cestino.BasicCartService,t.Cestino.PriceFormatter)}(this,function(o,e,t){"use strict";var s,u="__INCOMPLETE__",a=["load","add","change","remove"];c.prototype={add:function(t,e,i,n){var e=e||s.ProductQuantity.create(1),r="g"+(i=f.call(this,i)||s.ShippingGroup.create(i)).getName(),n=n||[];if(!(t instanceof c.Product))throw new TypeError("The product has to be a instance of Cart.Product!");o.isInt(e)&&(e=s.ProductQuantity.create(e));if(!(e instanceof c.ProductQuantity))throw new TypeError(["The quantity has to be a instance of Cart.ProductQuantity or a positive ","integer value!"].join(""));(i[" cart"]=this)[" shippingGroups"][r]=i;this[" positions"][r]=this[" positions"][r]||[];i="p"+this[" positionId"]++;((e=new p(i,t,n,e))[" cart"]=this)[" positions"][r].push(e);h.call(this,"add",e);return i},on:function(t,e){if("function"!=typeof e)throw new TypeError("The passed listener has to be a function!");if(-1===a.indexOf(t))throw new TypeError(t+" is an unknown event! Try one of these: "+a.join(", ")+".");this[" listener"][t].push(e);return this},off:function(i,n){var r=this;if(-1===a.indexOf(i))throw new TypeError(i+" is an unknown event! Try one of these: "+a.join(", ")+".");this[" listener"][i].some(function(t,e){if(n===t){r[" listener"][i].splice(e,1);return!0}});return this},calculateGroup:l,calculate:function(e){var i=this,n=0,e=e||!1;r.call(this).forEach(function(t){n+=l.call(i,t,e)});return n},deletePosition:function(t){var e=i.call(this,t);if(!e)throw new RefereneceError(["No position with id '",t,"' found!"].join(""));e=this[" positions"][e.group].splice(e.index,1)[0];h.call(this,"remove",e);return e},getShippingGroupByName:f,getPositionsOfGroup:function(t){var e=d.call(this,t);if(e in this[" positions"])return this[" positions"][e];throw new ReferenceError(["No shipping-group with name '",t,"' found!"].join(""))},getShippingGroups:r,getPositionById:function(t){var e=i.call(this,t);if(e)return this[" positions"][e.group][e.index];throw new ReferenceError(["No position with id '",t,"' found!"].join(""))},toJSON:function(){var i={date:(new Date).toISOString(),AutoPosId:this[" positionId"],pos:{}};this.walk(function(t,e){i.pos[e]=i.pos[e]||[];i.pos[e].push({id:t.getId(),product:{id:t.getProduct().getId()},quantity:{amount:t.getQuantity().getAmount(),dimX:t.getQuantity().getWidth(),dimY:t.getQuantity().getHeight(),dimZ:t.getQuantity().getDepth()},features:t.getFeatures().map(function(t){return t.getId()})})});return JSON.stringify(i)},fromJSON:function(t){var e,i,n,r,o=this;if(0!==Object.keys(this[" positions"]).length)throw new RangeError("Cart has to be empty when loading from a JSON!");e=JSON.parse(t);this[" positionId"]=e.AutoPosId;Object.keys(e.pos).forEach(function(t){r="g"+t;((n=s.ShippingGroup.create(t))[" cart"]=o)[" shippingGroups"][r]=n;e.pos[t].forEach(function(t){((i=new p(t.id,s.Product.create(t.product.id,u,987654321),t.features.map(function(t){return s.ProductFeature.create(t,u,987654321)}),s.ProductQuantity.create(t.quantity.amount,t.quantity.dimX,t.quantity.dimY,t.quantity.dimZ)))[" cart"]=o)[" positions"][r]=o[" positions"][r]||[];o[" positions"][r].push(i)})});this[" oCartService"].setProductDataToCart(this).then(function(){o[" listener"].load.forEach(function(t){t(o)})});return this},walk:function(i){var t=this;this.getShippingGroups().forEach(function(e){t.getPositionsOfGroup(e).forEach(function(t){i(t,e)})});return this}};function c(t){if("function"!=typeof(t=t||e.create()).setProductDataToCart)throw new TypeError(["The service has to be able to find Products! ","\n",'Implement a function named "setProductDataToCart" that takes one argument of type ',"Object. ","\n","The keys of the object has to represent product-ids, the ","values has to be arrays of selected product-feature-ids."].join(""));this[" positionId"]=1;this[" oCartService"]=t;this[" positions"]={};this[" shippingGroups"]={};this[" listener"]={add:[],remove:[],change:[],load:[]}}function p(t,e,i,n){this[" id"]=t;this[" product"]=e;this[" features"]=i;this[" quantity"]=n;this[" cart"]=null}(p.prototype={calculate:function(){var e=this,i=0;this[" features"].forEach(function(t){i+=t.getPrice(e)});return(this[" product"].getPrice(this)+i)*this[" quantity"].getFactor(this)},incrementAmount:function(t){t=t||1;if(!o.isInt(t))throw new TypeError("Amount has to be of type integer!");this[" quantity"][" amount"]+=t;h.call(this[" cart"],"change",this);return this},decrementAmount:function(t){t=t||1;if(!o.isInt(t))throw new TypeError("Amount has to be of type integer!");this[" quantity"][" amount"]-=t;h.call(this[" cart"],"change",this);return this},replaceQuantity:function(t){if(!(t instanceof c.ProductQuantity))throw new TypeError("The quantity has to be a instance of Cart.ProductQuantity!");this[" quantity"]=t;h.call(this[" cart"],"change",this);return this}}).getId=function(){return this[" id"]};p.prototype.getProduct=function(){return this[" product"]};p.prototype.getFeatures=function(){return this[" features"]};p.prototype.getQuantity=function(){return this[" quantity"]};p.prototype.getCart=function(){return this[" cart"]};(c.Product=function(t,e,i){if(o.isEmpty(t)||"string"!=typeof t&&!o.isInt(t))throw new RangeError("The product has to have an id of type string or integer!");if(o.isEmpty(e)||"string"!=typeof e)throw new RangeError("The product has to have a title of type string!");if(!o.isInt(i)||i<0)throw new TypeError("The price has to be an positive integer!");this[" id"]=t;this[" title"]=e;this[" price"]=i}).prototype.getId=function(){return this[" id"]};c.Product.prototype.getTitle=function(){return this[" title"]};c.Product.prototype.getPrice=function(t){return this[" price"]};(c.ProductQuantity=function(t,e,i,n){this[" amount"]=t;this[" dimensionX"]=e||1;this[" dimensionY"]=i||1;this[" dimensionZ"]=n||1;if(!(o.isInt(this[" amount"])&&o.isInt(this[" dimensionX"])&&o.isInt(this[" dimensionY"])&&o.isInt(this[" dimensionZ"])))throw new TypeError(["Invalid try to instanciate quantity. Not all parameters are integers! ","\ndata object: ",JSON.stringify(this),"\n"].join(""))}).prototype.getAmount=function(){return this[" amount"]};c.ProductQuantity.prototype.getLength=function(){return this[" dimensionX"]};c.ProductQuantity.prototype.getWidth=function(){return this[" dimensionX"]};c.ProductQuantity.prototype.getHeight=function(){return this[" dimensionY"]};c.ProductQuantity.prototype.getDepth=function(){return this[" dimensionZ"]};c.ProductQuantity.prototype.getFactor=function(t){return this.getAmount()*this.getWidth()*this.getHeight()*this.getDepth()};(c.ProductFeature=function(t,e,i){i=i||0;if(o.isEmpty(t)||"string"!=typeof t&&!o.isInt(t))throw new RangeError("The product feature has to have an id of type string or integer!");if(o.isEmpty(e)||"string"!=typeof e)throw new RangeError("The product feature has to have a title of type string!");if(!o.isInt(i)||i<0)throw new TypeError("The price has to be an positive integer!");this[" id"]=t;this[" price"]=i;this[" label"]=e}).prototype.getId=function(){return this[" id"]};c.ProductFeature.prototype.getPrice=function(t){return this[" price"]};c.ProductFeature.prototype.getLabel=function(){return this[" label"]};(c.ShippingGroup=function(t){this[" name"]=t||"";this[" cart"]=null;this[" price"]=0}).prototype.calculate=function(){return l.call(this.getCart(),this.getName(),includeShippingGroupCost||!0)};c.ShippingGroup.prototype.setPrice=function(t){if(!o.isInt(t)||t<0)throw new TypeError("The price has to be an positive integer!");this[" price"]=t;return this};c.ShippingGroup.prototype.getPrice=function(){return this[" price"]};c.ShippingGroup.prototype.getName=function(){return this[" name"]};c.ShippingGroup.prototype.getCart=function(){return this[" cart"]};function h(t,e){this[" listener"][t].forEach(function(t){t(e)})}function r(){return Object.keys(this[" positions"]).map(function(t){return t.substr(1)})}function f(t){var e=t instanceof c.ShippingGroup,i="g"+(e&&t.getName()||t||"");return i in this[" shippingGroups"]&&this[" shippingGroups"][i]||e&&t||!1}function d(t){return"g"+(t instanceof c.ShippingGroup&&t.getName()||t||"")}function l(t,e){var i=0,e=e||!1,n=d.call(this,t);this.getPositionsOfGroup(t).forEach(function(t){i+=t.calculate()});return i+(e&&this[" shippingGroups"][n].getPrice()||0)}function i(n){var t=this[" positions"],r=!1;Object.keys(t).some(function(i){t[i].some(function(t,e){return!!(r=t.getId()===n?{group:i,index:e}:r)});return!!r});return r}function n(e){var t,i=e.prototype;e.prototype=Object.create(this.prototype);(e.prototype.constructor=e).prototype.getSuperMethod=function(t){return this.__proto__.__proto__[t].bind(this)};for(t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e.prototype[t]=i[t]);return{create:function(){var i=Object.create(e.prototype),n=arguments;!function t(e){e.__proto__.__proto__&&t(e.__proto__);e.__proto__.constructor.apply(i,n)}(i);return i},extendWith:function(t){return n.bind(e)(t)}}}function g(t){return function(){return new c[t](void 0!==arguments[0]&&arguments[0]||void 0,void 0!==arguments[1]&&arguments[1]||void 0,void 0!==arguments[2]&&arguments[2]||void 0,void 0!==arguments[3]&&arguments[3]||void 0)}}return s={create:function(t){return new c(t)},Util:o,PriceFormatter:t,BasicCartService:e,Product:{create:g("Product"),extendWith:n.bind(c.Product)},ProductFeature:{create:g("ProductFeature"),extendWith:n.bind(c.ProductFeature)},ProductQuantity:{create:g("ProductQuantity"),extendWith:n.bind(c.ProductQuantity)},ShippingGroup:{create:g("ShippingGroup"),extendWith:n.bind(c.ShippingGroup)},overridePositionCalculation:function(t){p.prototype.calculate=t}}});"function"==typeof define&&define.amd&&define(["cestino/Cart"],function(t){return t});